<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>YLE Vocabulary â€“ Starters / Movers / Flyers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <h1>YLE Vocabulary Cards</h1>
  <div class="subtitle">Starters / Movers / Flyers å–®å­—</div>

  <div class="top-bar">
    <div class="level-tabs">
      <button class="level-tab level-starters active" data-level="starters">
        <span class="icon">ğŸŒ±</span> Starters
      </button>
      <button class="level-tab level-movers" data-level="movers">
        <span class="icon">ğŸš¶â€â™‚ï¸</span> Movers
      </button>
      <button class="level-tab level-flyers" data-level="flyers">
        <span class="icon">ğŸ•Šï¸</span> Flyers
      </button>
    </div>

    <button class="print-btn" id="printBtn">ğŸ–¨ï¸ åˆ—å°</button>
  </div>

  <!-- å–®ä¸€æœå°‹æ¡†ï¼Œä¸­è‹±çš†å¯ -->
  <div class="search-card">
    <input id="searchBox" type="text" placeholder="æœå°‹è‹±æ–‡æˆ–ä¸­æ–‡â€¦">
  </div>

  <div class="main-layout">
    <aside class="sidebar">
      <div class="category-buttons">
        <div class="cat-title">
          ä¸»é¡Œé¸æ“‡ï¼ˆç›®å‰ï¼š<span id="currentLevelLabel">Starters</span>ï¼‰
        </div>

        <button class="cat-btn special active" data-cat="all">
          å…¨éƒ¨ä¸»é¡Œ <span class="count" id="countAll">0</span>
        </button>

        <button class="cat-btn special" data-cat="flat">
          ä¸åˆ†ä¸»é¡Œï¼ˆå…¨éƒ¨å–®å­—ï¼‰ <span class="count" id="countFlat">0</span>
        </button>

        <div id="categoryList"></div>
      </div>
    </aside>

    <main class="content">
      <div class="word-panel">
        <div class="panel-title">
          <div>
            <span class="panel-title-main" id="panelTitle">å…¨éƒ¨ä¸»é¡Œ</span>
            <span class="panel-title-sub" id="panelSubtitle">é¡¯ç¤ºæ‰€æœ‰ä¸»é¡Œèˆ‡å–®å­—</span>
          </div>
          <span class="panel-badge" id="panelBadge">Starters Â· 0 è©</span>
        </div>
        <div id="wordContent"></div>
      </div>
    </main>
  </div>

  <!-- è³‡æ–™æª”ï¼šå…§å« LEVEL_CONFIG / DATASETS -->
  <script src="data.js"></script>

  <script>
    /***********************
     * ç‹€æ…‹
     ***********************/
    let currentLevel = 'starters';
    let currentCategoryId = 'all';  // 'all' | 'flat' | category.id
    let searchKey = '';             // å–®ä¸€æœå°‹å­—ä¸²ï¼ˆä¸­è‹±éƒ½ç”¨é€™å€‹ï¼‰

    /***********************
     * DOM
     ***********************/
    const levelTabs = document.querySelectorAll('.level-tab');
    const currentLevelLabel = document.getElementById('currentLevelLabel');
    const categoryListEl = document.getElementById('categoryList');
    const countAllEl = document.getElementById('countAll');
    const countFlatEl = document.getElementById('countFlat');
    const panelTitleEl = document.getElementById('panelTitle');
    const panelSubtitleEl = document.getElementById('panelSubtitle');
    const panelBadgeEl = document.getElementById('panelBadge');
    const wordContentEl = document.getElementById('wordContent');
    const searchBox = document.getElementById('searchBox');
    const printBtn = document.getElementById('printBtn');

    /***********************
     * å·¥å…·
     ***********************/
    function getAllWords(dataset) {
      const out = [];
      (dataset.categories || []).forEach(cat => {
        (cat.words || []).forEach(w => {
          out.push({
            ...w,
            categoryId: cat.id,
            categoryLabel: cat.label,
            categoryIcon: cat.icon
          });
        });
      });
      return out;
    }

    function getAllWordsFromAllLevels() {
      const out = [];
      for (const levelKey in DATASETS) {
        const dataset = DATASETS[levelKey];
        (dataset.categories || []).forEach(cat => {
          (cat.words || []).forEach(w => {
            out.push({
              ...w,
              level: levelKey,
              levelLabel: LEVEL_CONFIG[levelKey].label,
              levelIcon: LEVEL_CONFIG[levelKey].color,
              categoryId: cat.id,
              categoryLabel: cat.label,
              categoryIcon: cat.icon
            });
          });
        });
      }
      return out;
    }

    const normalize = (s) => (s || '').toString().trim().toLowerCase();

    function filteredWordsAllLevelsSingleKey(key) {
      const all = getAllWordsFromAllLevels();
      const k = normalize(key);
      if (!k) return all;
      return all.filter(w => {
        const enText = (w.en + ' ' + (w.pos || '')).toLowerCase();
        const zhText = (w.zh || '').toLowerCase();
        return enText.includes(k) || zhText.includes(k);
      });
    }

    /***********************
     * æ¸²æŸ“å´é‚Šä¸»é¡Œ
     ***********************/
    function renderCategoryButtons() {
      const dataset = DATASETS[currentLevel];
      const cats = dataset.categories || [];
      categoryListEl.innerHTML = '';

      const allWords = getAllWords(dataset);
      countAllEl.textContent = allWords.length;
      countFlatEl.textContent = allWords.length;

      cats.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'cat-btn';
        btn.dataset.cat = cat.id;
        btn.innerHTML = `
          <span>${cat.icon || ''} ${cat.label}</span>
          <span class="count">${(cat.words || []).length}</span>
        `;
        btn.addEventListener('click', () => {
          currentCategoryId = cat.id;
          searchKey = '';
          searchBox.value = '';
          updateAll();
        });
        categoryListEl.appendChild(btn);
      });

      // special active
      document.querySelectorAll('.cat-btn.special').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.cat === currentCategoryId) {
          btn.classList.add('active');
        }
      });

      // category active
      document.querySelectorAll('.cat-btn').forEach(btn => {
        if (!btn.classList.contains('special')) {
          btn.classList.toggle('active', btn.dataset.cat === currentCategoryId);
        }
      });
    }

    /***********************
     * æ¸²æŸ“ä¸»å…§å®¹
     ***********************/
    function renderContent() {
      const dataset = DATASETS[currentLevel];
      const cats = dataset.categories || [];
      const levelLabel = LEVEL_CONFIG[currentLevel].label;

      const hasSearch = !!normalize(searchKey);

      // ğŸ” æœå°‹æ¨¡å¼ï¼šè·¨ç­‰ç´š
      if (hasSearch) {
        const words = filteredWordsAllLevelsSingleKey(searchKey);

        panelTitleEl.textContent = 'æœå°‹çµæœï¼ˆå…¨éƒ¨ç­‰ç´šï¼‰';
        panelSubtitleEl.textContent = words.length
          ? `å…± ${words.length} å€‹ç¬¦åˆçš„å–®å­—`
          : 'æ²’æœ‰ç¬¦åˆé—œéµå­—çš„å–®å­—';
        panelBadgeEl.textContent = 'Starters / Movers / Flyers Â· æœå°‹ä¸­';

        if (!words.length) {
          wordContentEl.innerHTML =
            '<div class="empty-state">ç›®å‰æŸ¥ä¸åˆ°ç›¸ç¬¦çš„å–®å­—ã€‚</div>';
          return;
        }

        wordContentEl.innerHTML = `
          <div class="flat-note">ä¾è‹±æ–‡å­—æ¯æ’åºï¼Œä¸åˆ†ä¸»é¡Œã€ä¸åˆ†ç­‰ç´šã€‚</div>
          <div class="word-grid">
            ${
              words
                .sort((a, b) => {
                  const c = a.en.localeCompare(b.en);
                  if (c !== 0) return c;
                  return (a.levelLabel || '').localeCompare(b.levelLabel || '');
                })
                .map(w => `
                  <div class="word-cell">
                    <div class="word-en-zh">
                      <span class="word-en">${w.en}</span>
                      ${w.pos ? `<span class="word-pos">${w.pos}</span>` : ''}
                      ${w.zh ? `<span class="word-zh">${w.zh}</span>` : ''}
                    </div>
                    <div style="font-size:0.7rem;color:#999;margin-top:1px;">
                      ${w.levelIcon || ''} ${w.levelLabel || ''}
                      ï½œ ${w.categoryIcon || ''} ${w.categoryLabel || ''}
                    </div>
                  </div>
                `)
                .join('')
            }
          </div>
        `;
        return;
      }

      // ä¸åˆ†ä¸»é¡Œï¼ˆç›®å‰ç­‰ç´šå…¨éƒ¨å–®å­—ï¼‰
      if (currentCategoryId === 'flat') {
        const words = getAllWords(dataset);
        panelTitleEl.textContent = 'ä¸åˆ†ä¸»é¡Œï¼ˆå…¨éƒ¨å–®å­—ï¼‰';
        panelSubtitleEl.textContent =
          'ä¾è‹±æ–‡å­—æ¯æ’åºï¼Œå…©å€‹ä¸€åˆ—ï¼Œæ–¹ä¾¿èƒŒèª¦èˆ‡åˆ—å°ã€‚';
        panelBadgeEl.textContent = `${levelLabel} Â· ${words.length} è©`;

        wordContentEl.innerHTML = `
          <div class="flat-note">ç›®å‰åªé¡¯ç¤ºã€Œ${levelLabel}ã€ç­‰ç´šçš„å…¨éƒ¨å–®å­—ã€‚</div>
          <div class="word-grid">
            ${
              words
                .sort((a, b) => a.en.localeCompare(b.en))
                .map(w => `
                  <div class="word-cell">
                    <div class="word-en-zh">
                      <span class="word-en">${w.en}</span>
                      ${w.pos ? `<span class="word-pos">${w.pos}</span>` : ''}
                      ${w.zh ? `<span class="word-zh">${w.zh}</span>` : ''}
                    </div>
                  </div>
                `)
                .join('')
            }
          </div>
        `;
        return;
      }

      // å…¨éƒ¨ä¸»é¡Œï¼ˆç›®å‰ç­‰ç´šï¼‰
      if (currentCategoryId === 'all') {
        panelTitleEl.textContent = 'å…¨éƒ¨ä¸»é¡Œ';
        panelSubtitleEl.textContent =
          'æ¯ä¸€å€‹å¤§ä¸»é¡Œåˆ†æ®µé¡¯ç¤ºã€‚';

        const allWordsCount = getAllWords(dataset).length;
        panelBadgeEl.textContent =
          `${levelLabel} Â· å…± ${cats.length} ä¸»é¡Œ Â· ${allWordsCount} è©`;

        if (!cats.length) {
          wordContentEl.innerHTML =
            '<div class="empty-state">é€™å€‹ç­‰ç´šç›®å‰å°šæœªåŠ å…¥ä»»ä½•ä¸»é¡Œè³‡æ–™ã€‚</div>';
          return;
        }

        wordContentEl.innerHTML = `
          <div class="categories-container">
            ${
              cats
                .map(cat => `
                  <section class="category-block">
                    <div class="category-header-grid">
                      <div class="category-name">
                        <span class="icon">${cat.icon || ''}</span>
                        <span>${cat.label}</span>
                      </div>
                      <div class="category-header-spacer"></div>
                    </div>
                    <div class="word-grid">
                      ${
                        (cat.words || [])
                          .map(w => `
                            <div class="word-cell">
                              <div class="word-en-zh">
                                <span class="word-en">${w.en}</span>
                                ${w.pos ? `<span class="word-pos">${w.pos}</span>` : ''}
                                ${w.zh ? `<span class="word-zh">${w.zh}</span>` : ''}
                              </div>
                            </div>
                          `)
                          .join('')
                      }
                    </div>
                  </section>
                `)
                .join('')
            }
          </div>
        `;
        return;
      }

      // å–®ä¸€ä¸»é¡Œï¼ˆç›®å‰ç­‰ç´šï¼‰
      const cat = (cats || []).find(c => c.id === currentCategoryId);
      if (!cat) {
        wordContentEl.innerHTML =
          '<div class="empty-state">æ‰¾ä¸åˆ°é€™å€‹ä¸»é¡Œã€‚</div>';
        panelTitleEl.textContent = 'ä¸»é¡Œä¸å­˜åœ¨';
        panelSubtitleEl.textContent = '';
        panelBadgeEl.textContent = levelLabel;
        return;
      }

      panelTitleEl.textContent = cat.label;
      panelSubtitleEl.textContent = 'åªé¡¯ç¤ºé€™ä¸€å€‹ä¸»é¡Œçš„å–®å­—ã€‚';
      panelBadgeEl.textContent = `${levelLabel} Â· ${(cat.words || []).length} è©`;

      wordContentEl.innerHTML = `
        <div class="categories-container">
          <section class="category-block">
            <div class="category-header-grid">
              <div class="category-name">
                <span class="icon">${cat.icon || ''}</span>
                <span>${cat.label}</span>
              </div>
              <div class="category-header-spacer"></div>
            </div>
            <div class="word-grid">
              ${
                (cat.words || [])
                  .map(w => `
                    <div class="word-cell">
                      <div class="word-en-zh">
                        <span class="word-en">${w.en}</span>
                        ${w.pos ? `<span class="word-pos">${w.pos}</span>` : ''}
                        ${w.zh ? `<span class="word-zh">${w.zh}</span>` : ''}
                      </div>
                    </div>
                  `)
                  .join('')
              }
            </div>
          </section>
        </div>
      `;
    }

    /***********************
     * updateAll
     ***********************/
    function updateAll() {
      currentLevelLabel.textContent = LEVEL_CONFIG[currentLevel].label;
      levelTabs.forEach(tab => {
        tab.classList.toggle('active', tab.dataset.level === currentLevel);
      });
      renderCategoryButtons();
      renderContent();
    }

    /***********************
     * äº‹ä»¶ç¶å®š
     ***********************/
    levelTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const level = tab.dataset.level;
        if (level === currentLevel) return;
        currentLevel = level;
        currentCategoryId = 'all';
        searchKey = '';
        searchBox.value = '';
        updateAll();
      });
    });

    document.querySelectorAll('.cat-btn.special').forEach(btn => {
      btn.addEventListener('click', () => {
        currentCategoryId = btn.dataset.cat;
        searchKey = '';
        searchBox.value = '';
        updateAll();
      });
    });

    searchBox.addEventListener('input', () => {
      searchKey = searchBox.value;
      if (searchKey) {
        renderContent(); // æœå°‹æ¨¡å¼
      } else {
        currentCategoryId = 'all';
        updateAll();
      }
    });

    printBtn.addEventListener('click', () => window.print());

    updateAll();
  </script>
</body>
</html>
